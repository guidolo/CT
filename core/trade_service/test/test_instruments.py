import pandas as pd
import numpy as np
from core.trade_service.instruments.moving_averages import WMA

def test_wma():
    input_values  = [81.59,81.06,82.87,83.00,83.61,83.15,82.84,83.99,84.55,84.36,85.53,86.54,86.89,87.77,87.29]
    output_values = [                        82.43,82.57,82.62,82.90,83.23,83.45,83.87,84.40,84.90,85.47,85.84]
    temp = pd.DataFrame(input_values, columns=['input'])
    assert np.round(WMA(temp, 'input', 5), 2) == output_values


open_ = [120.17,121.31,121.91,123.09,122.79,122.07,120.46,120.33,119.95,121.51,119.22,119.35,118.74,118.42]
high = [120.74,121.71,121.94,123.31,123.16,122.08,120.91,120.69,120.71,121.88,119.5,119.5,118.84,118.46]
low = [120.06,121.19,121.58,122.77,122.02,120.95,120.4,120.27,119.92,119.57,119.13,119.24,118.33,118.07]
close = [120.72,121.61,121.73,123.1,122.45,121.65,120.54,120.36,120.48,119.82,119.32,119.34,118.43,118.18]
TR_ = [0.99,0.36,1.58,1.14,1.5,1.25,0.42,0.79,2.31,0.69,0.26,1.01,0.39]
STR = [1.114,1.166,1.178,1.02,1.254,1.092,0.894,1.012,0.932]
ATR_ = [1.114,1.1412,0.99696,0.955568,1.226454,1.119164,0.947331,0.959865,0.845892]

temp = pd.DataFrame(data={'open':open_, 'high':high, 'low':low, 'close':close})
temp.loc[:,'TR'] = [np.NaN] + TR(temp).round(2).tolist()[1:]
SMA(temp, 'TR', 5)
WMA(temp, 'TR', 5)